<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>iOS项目编译脚本 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="背景 使用xcode打包上传到itunes中间需要手动选择签名文件的步骤比较繁琐和浪费时间  解决问题的思路 使用shell语言将iOS项目的编译,导出ipa包,签名校验, 上传流程封装成脚本实现一键搞定。  代码实例编译过程 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS项目编译脚本">
<meta property="og:url" content="http://example.com/2021/09/16/ios-build/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="背景 使用xcode打包上传到itunes中间需要手动选择签名文件的步骤比较繁琐和浪费时间  解决问题的思路 使用shell语言将iOS项目的编译,导出ipa包,签名校验, 上传流程封装成脚本实现一键搞定。  代码实例编译过程 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474">
<meta property="og:locale">
<meta property="article:published_time" content="2021-09-16T05:38:28.218Z">
<meta property="article:modified_time" content="2021-09-16T07:00:38.853Z">
<meta property="article:author" content="Jian Chen">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Suche"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Suche"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-ios-build" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/16/ios-build/" class="article-date">
  <time class="dt-published" datetime="2021-09-16T05:38:28.218Z" itemprop="datePublished">2021-09-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      iOS项目编译脚本
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><ul>
<li>使用xcode打包上传到itunes中间需要手动选择签名文件的步骤比较繁琐和浪费时间</li>
</ul>
<h2 id="解决问题的思路"><a href="#解决问题的思路" class="headerlink" title="解决问题的思路"></a>解决问题的思路</h2><ul>
<li>使用shell语言将iOS项目的编译,导出ipa包,签名校验, 上传流程封装成脚本实现一键搞定。</li>
</ul>
<h2 id="代码实例"><a href="#代码实例" class="headerlink" title="代码实例"></a>代码实例</h2><h3 id="编译过程"><a href="#编译过程" class="headerlink" title="编译过程"></a>编译过程</h3> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> =============项目自定义部分(自定义好下列参数后再执行该脚本)=================== <span class="comment">#</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 是否编译工作空间 (例:若是用Cocopods管理的.xcworkspace项目,赋值<span class="literal">true</span>;用Xcode默认创建的.xcodeproj,赋值<span class="literal">false</span>)</span></span><br><span class="line">is_workspace=&quot;true&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> .xcworkspace的名字，如果is_workspace为<span class="literal">true</span>，则必须填。否则可不填</span></span><br><span class="line">workspace_name=&quot;xxx&quot;     #XXX 就是你.xcworkspace工程的名称</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> .xcodeproj的名字，如果is_workspace为<span class="literal">false</span>，则必须填。否则可不填</span></span><br><span class="line">project_name=&quot;xxx&quot;          #XXX 就是你.xcodeproj工程的名称</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> releaseType 上传appstore 的类型</span></span><br><span class="line">releaseType=&quot;RC&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> envirmentType 上传appstore 的类型</span></span><br><span class="line">envirmentType=&quot;t&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> gMarketVersion defaultvalue</span></span><br><span class="line">localMarketVersion=1.0.0</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> build version defaultvalue</span></span><br><span class="line">localVersion=0</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取当前脚本所在目录</span></span><br><span class="line">script_dir=&quot;$( cd &quot;$( dirname &quot;$0&quot;  )&quot; &amp;&amp; pwd  )&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 工程根目录</span></span><br><span class="line">project_dir=$script_dir</span><br><span class="line"><span class="meta">#</span><span class="bash"> 用户主目录</span></span><br><span class="line">usermain_dir=&quot;$( cd &amp;&amp; pwd  )&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取version和buildVersion</span></span><br><span class="line">function getMarketVersion &#123;</span><br><span class="line">marketVersion=$(agvtool what-marketing-version -terse1)</span><br><span class="line">if [ &quot;$&#123;marketVersion&#125;&quot;==&quot;\$\(MARKETING_VERSION\)&quot; ]</span><br><span class="line">then</span><br><span class="line">localMarketVersion=`sed -n &#x27;/MARKETING_VERSION/&#123;s/MARKETING_VERSION = //;s/;//;s/^[[:space:]]*//;p;q;&#125;&#x27; ./$&#123;project_name&#125;.xcodeproj/project.pbxproj`</span><br><span class="line">else</span><br><span class="line">localMarketVersion=&quot;$&#123;marketVersion&#125;&quot;</span><br><span class="line">fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function getBuildVersion &#123;</span><br><span class="line">getRemoteTagbuildNumber</span><br><span class="line">if [ $localVersion -eq 0 ]</span><br><span class="line">then</span><br><span class="line">echo &quot;033[31;1mget remote tag build Version faild\033[0m&quot;</span><br><span class="line">getLocalTagbuildNumber</span><br><span class="line">if [ $localVersion -eq 0 ]</span><br><span class="line">then</span><br><span class="line">echo &quot;033[31;1mget local tag buildNumber Faild\033[0m&quot;</span><br><span class="line">getProjBuildVresion</span><br><span class="line">fi</span><br><span class="line">fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取项目git服务器上面 tag 中的buildVersion (根据实际情况修改)</span></span><br><span class="line">function getRemoteTagbuildNumber &#123;</span><br><span class="line">tags=$(git ls-remote --tags origin | grep -v &#x27;\^&#x27; | sed &#x27;s_^.*/\\([^/&#125;]*\\)$_\\1_p&#x27; | sort -V)</span><br><span class="line">tagarray=($tags)</span><br><span class="line">for tagStr in $&#123;tagarray[@]&#125;</span><br><span class="line">do</span><br><span class="line">if [[ $tagStr =~ ^(refs/tags/)?([0-9]+.?)&#123;2,3&#125;(-|.)(Beta|RC).[0-9]+.(t|s|p)$ ]]</span><br><span class="line">then</span><br><span class="line"><span class="meta">#</span><span class="bash">将.替换成空格然后分割</span></span><br><span class="line">tagArrayStr=$(echo $tagStr | tr &#x27;.&#x27; &#x27; &#x27;)</span><br><span class="line">tagSplits=($tagArrayStr)</span><br><span class="line">tempBuildNumber=$&#123;tagSplits[$&#123;#tagSplits[@]&#125;-2]&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$tempBuildNumber</span>  <span class="variable">$localVersion</span>&quot;</span></span></span><br><span class="line">if [ $tempBuildNumber -gt $localVersion ]</span><br><span class="line">then</span><br><span class="line">localVersion=$&#123;tempBuildNumber&#125;</span><br><span class="line">fi</span><br><span class="line">fi</span><br><span class="line">done</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取项目本地git tag 中的buildVersion (根据实际情况修改)</span></span><br><span class="line">function getLocalTagbuildNumber &#123;</span><br><span class="line">tags=$(git tag | sed &#x27;s_^.*/\\([^/&#125;]*\\)$_\\1_p&#x27; | sort -V)</span><br><span class="line">tagarray=($tags)</span><br><span class="line">for tagStr in $&#123;tagarray[@]&#125;</span><br><span class="line">do</span><br><span class="line">if [[ $tagStr =~ ^(refs/tags/)?([0-9]+.?)&#123;2,3&#125;(-|.)(Beta|RC).[0-9]+.(t|s|p)$ ]]</span><br><span class="line">then</span><br><span class="line"><span class="meta">#</span><span class="bash">将.替换成空格然后分割</span></span><br><span class="line">tagArrayStr=$(echo $tagStr | tr &#x27;.&#x27; &#x27; &#x27;)</span><br><span class="line">tagSplits=($tagArrayStr)</span><br><span class="line">tempBuildNumber=$&#123;tagSplits[$&#123;#tagSplits[@]&#125;-2]&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$tempBuildNumber</span>  <span class="variable">$localVersion</span>&quot;</span></span></span><br><span class="line">if [ $tempBuildNumber -gt $localVersion ]</span><br><span class="line">then</span><br><span class="line">localVersion=$&#123;tempBuildNumber&#125;</span><br><span class="line">fi</span><br><span class="line">fi</span><br><span class="line">done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function getProjBuildVresion &#123;</span><br><span class="line">versions=$(agvtool what-version -terse)</span><br><span class="line"><span class="meta">#</span><span class="bash">判断versions是否不为空</span></span><br><span class="line">if [ -n &quot;$versions&quot; ]</span><br><span class="line">then</span><br><span class="line"><span class="meta">#</span><span class="bash">split versions</span></span><br><span class="line">versionArr=($versions)</span><br><span class="line">localVersion=$&#123;versionArr[0]&#125;</span><br><span class="line">for tempVersion in $&#123;versionArr[*]&#125;</span><br><span class="line">do</span><br><span class="line">if [ $tempVersion -gt $localVersion ]</span><br><span class="line">then</span><br><span class="line">localVersion=$tempVersion</span><br><span class="line">fi</span><br><span class="line">done</span><br><span class="line">fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装Provisioning文件</span></span><br><span class="line">function installmobileprovision &#123;</span><br><span class="line"><span class="meta">#</span><span class="bash"> =======================安装Provisioning文件(无特殊情况不用修改)====================== <span class="comment">#</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取mobileprovision文件的uuid</span></span><br><span class="line"> mobileprovision_path=&quot;$&#123;project_dir&#125;/mobileprovision/$&#123;mobileprovision_name&#125;.mobileprovision&quot;</span><br><span class="line"> notifacationprovision_path=&quot;$&#123;project_dir&#125;/mobileprovision/$&#123;notifacationprovision_name&#125;.mobileprovision&quot;</span><br><span class="line"> mobileprovision_uuid=`/usr/libexec/PlistBuddy -c &#x27;Print UUID&#x27; /dev/stdin &lt;&lt;&lt; $(security cms -D -i $&#123;mobileprovision_path&#125;)`</span><br><span class="line"> notifacationprovision_uuid=`/usr/libexec/PlistBuddy -c &#x27;Print UUID&#x27; /dev/stdin &lt;&lt;&lt; $(security cms -D -i $&#123;notifacationprovision_path&#125;)`</span><br><span class="line"> </span><br><span class="line">echo &quot;\033[32;1m mobileprovision_uuid: $mobileprovision_uuid \033[0m&quot;</span><br><span class="line">echo &quot;\033[32;1m notifacationprovision_uuid: $notifacationprovision_uuid \033[0m&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装mobileprovision文件到指定目录</span></span><br><span class="line">mobileprovisionoutput=&quot;$&#123;usermain_dir&#125;/Library/MobileDevice/Provisioning Profiles/$mobileprovision_uuid.mobileprovision&quot;</span><br><span class="line">if [ ! -f &quot;$mobileprovisionoutput&quot; ]</span><br><span class="line">then</span><br><span class="line">cp &quot;$&#123;mobileprovision_path&#125;&quot; $&#123;usermain_dir&#125;/Library/MobileDevice/Provisioning\ Profiles/$mobileprovision_uuid.mobileprovision</span><br><span class="line">echo &quot;\033[32;1m安装 $&#123;mobileprovision_path&#125; -&gt; $mobileprovision_uuid.mobileprovision \033[0m&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">notifyprovisionoutput=&quot;$&#123;usermain_dir&#125;/Library/MobileDevice/Provisioning Profiles/$notifacationprovision_uuid.mobileprovision&quot;</span><br><span class="line">if [ ! -f &quot;$notifyprovisionoutput&quot; ]</span><br><span class="line">then</span><br><span class="line">cp &quot;$&#123;notifacationprovision_path&#125;&quot; $&#123;usermain_dir&#125;/Library/MobileDevice/Provisioning\ Profiles/$notifacationprovision_uuid.mobileprovision</span><br><span class="line">echo &quot;\033[32;1m安装 $&#123;notifacationprovision_path&#125; -&gt; $mobileprovision_uuid.mobileprovision \033[0m&quot;</span><br><span class="line">fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定项目的scheme名称（也就是工程的target名称），必填</span></span><br><span class="line"><span class="meta">#</span><span class="bash">scheme_name=<span class="string">&quot;xxx&quot;</span>     <span class="comment">#xxx 就是你工程里面某个target的scheme名称</span></span></span><br><span class="line">echo &quot;-------------------------选择需要编译的scheme-----------------------------&quot;</span><br><span class="line">echo &quot;\033[36;1m选择需要打包的scheme(输入序号,按回车即可)\033[0m&quot;</span><br><span class="line">echo &quot;\033[33;1m1. gy-test       \033[0m&quot;</span><br><span class="line">echo &quot;\033[33;1m2. gy-staging    \033[0m&quot;</span><br><span class="line">echo &quot;\033[33;1m3. gy-production  \033[0m&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 读取用户输入并存到变量里</span></span><br><span class="line">read toBeBuildeSchemeIndex</span><br><span class="line">sleep 0.5</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 判读用户是否有输入</span></span><br><span class="line">if [ -n &quot;$toBeBuildeSchemeIndex&quot; ]</span><br><span class="line">then</span><br><span class="line">    if [ &quot;$toBeBuildeSchemeIndex&quot; = &quot;1&quot; ] ; then</span><br><span class="line">        scheme_name=&quot;gy-test&quot;</span><br><span class="line">    elif [ &quot;$toBeBuildeSchemeIndex&quot; = &quot;2&quot; ] ; then</span><br><span class="line">        scheme_name=&quot;gy-staging&quot;</span><br><span class="line">        envirmentType=&quot;s&quot;</span><br><span class="line">    elif [ &quot;$toBeBuildeSchemeIndex&quot; = &quot;3&quot; ] ; then</span><br><span class="line">        scheme_name=&quot;gy-production&quot;</span><br><span class="line">        envirmentType=&quot;p&quot;</span><br><span class="line">    else</span><br><span class="line">        echo &quot;输入的参数无效!!!&quot;</span><br><span class="line">        exit 1</span><br><span class="line">    fi</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">echo &quot;\033[35;1m您的项目target的scheme名称为\033[0m&quot;</span><br><span class="line">echo &quot;\033[32;1m$&#123;scheme_name&#125;\033[0m&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定要打包编译的方式 : Release,Debug。一般用Release。必填</span></span><br><span class="line">build_configuration=&quot;Release&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> method，打包的方式。方式分别为 development, ad-hoc, app-store, enterprise 。必填</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">method=<span class="string">&quot;ad-hoc&quot;</span></span></span><br><span class="line"></span><br><span class="line">echo &quot;-------------------------选择打包方式-----------------------------&quot;</span><br><span class="line">echo &quot;\033[36;1m请选择打包方式(输入序号,按回车即可) \033[0m&quot;</span><br><span class="line">echo &quot;\033[33;1m1. AdHoc       \033[0m&quot;</span><br><span class="line">echo &quot;\033[33;1m2. AppStore    \033[0m&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 读取用户输入并存到变量里</span></span><br><span class="line">read parameter</span><br><span class="line">sleep 0.5</span><br><span class="line"></span><br><span class="line">packMethod=&quot;$parameter&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 判读用户是否有输入</span></span><br><span class="line">if [ -n &quot;$packMethod&quot; ]</span><br><span class="line">then</span><br><span class="line">    if [ &quot;$packMethod&quot; = &quot;1&quot; ] ; then</span><br><span class="line">        method=&quot;ad-hoc&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash">        mobileprovision_name=<span class="string">&quot;1b9b1d8d-51d7-4067-86ac-8ade662e082f&quot;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">        notifacationprovision_name=<span class="string">&quot;4941a376-efea-4437-be3d-072982d29e19&quot;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">mobileprovision</span></span><br><span class="line">        mobileprovision_name=&quot;xxxAdHoc&quot;</span><br><span class="line">        notifacationprovision_name=&quot;xxxnotificationserviceAdHoc&quot;</span><br><span class="line">    elif [ &quot;$packMethod&quot; = &quot;2&quot; ] ; then</span><br><span class="line">        method=&quot;app-store&quot;</span><br><span class="line">        mobileprovision_name=&quot;xxxAppStore&quot;</span><br><span class="line">        notifacationprovision_name=&quot;xxxnotificationserviceAppStore&quot;</span><br><span class="line">    else</span><br><span class="line">        echo &quot;输入的参数无效!!!&quot;</span><br><span class="line">        exit 1</span><br><span class="line">    fi</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">echo &quot;\033[35;1m打包方式method:\033[0m&quot;</span><br><span class="line">echo &quot;\033[32;1m$&#123;method&#125;\033[0m&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">  下面两个参数只是在手动指定Pofile文件的时候用到，如果使用Xcode自动管理Profile,直接留空就好</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> (跟method对应的)mobileprovision文件名，需要先双击安装.mobileprovision文件.手动管理Profile时必填</span></span><br><span class="line"><span class="meta">#</span><span class="bash">mobileprovision_name=<span class="string">&quot;fdc32c94-1d86-4d22-afc0-4bd44fcc6877&quot;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">notifacationprovision_name=<span class="string">&quot;88f0a0bc-2cb2-4554-af20-b25b79da389c&quot;</span> <span class="comment">#mobileprovision 文件的uuid</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 项目的bundleID，手动管理Profile时必填</span></span><br><span class="line">bundle_identifier=&quot;com.guanyu.gy&quot;</span><br><span class="line">notificationService_identifier=&quot;com.guanyu.gy.NotificationService&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">echo &quot;--------------------脚本配置参数检查--------------------&quot;</span><br><span class="line">echo &quot;\033[33;1mis_workspace=$&#123;is_workspace&#125; &quot;</span><br><span class="line">echo &quot;workspace_name=$&#123;workspace_name&#125;&quot;</span><br><span class="line">echo &quot;project_name=$&#123;project_name&#125;&quot;</span><br><span class="line">echo &quot;scheme_name=$&#123;scheme_name&#125;&quot;</span><br><span class="line">echo &quot;build_configuration=$&#123;build_configuration&#125;&quot;</span><br><span class="line">echo &quot;bundle_identifier=$&#123;bundle_identifier&#125;&quot;</span><br><span class="line">echo &quot;method=$&#123;method&#125;&quot;</span><br><span class="line">echo &quot;mobileprovision_name=$&#123;mobileprovision_name&#125;&quot;</span><br><span class="line">echo &quot;notifacationprovision_name=$&#123;notifacationprovision_name&#125; \033[0m&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">echo &quot;-------------------------选择发布平台-----------------------------&quot;</span><br><span class="line">echo &quot;\033[36;1m请选择发布平台(输入序号,按回车即可) \033[0m&quot;</span><br><span class="line">echo &quot;\033[33;1m1. AppStore      \033[0m&quot;</span><br><span class="line">echo &quot;\033[33;1m2. 蒲公英pgyer    \033[0m&quot;</span><br><span class="line">echo &quot;\033[33;1m3. fir平台  \033[0m&quot;</span><br><span class="line">echo &quot;\033[33;1m4. 不发布 \033[0m&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 读取用户输入并存到变量里</span></span><br><span class="line">read uploadTypeParameter</span><br><span class="line"></span><br><span class="line">sleep 0.5</span><br><span class="line"></span><br><span class="line">uploadType=&quot;$uploadTypeParameter&quot;</span><br><span class="line"></span><br><span class="line">getMarketVersion</span><br><span class="line">getBuildVersion</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 选择发布到appstore buildNumber自增 gitcommit gittag git push origin</span></span><br><span class="line">if [ &quot;$uploadType&quot; = &quot;1&quot; ] ; then</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">set</span> marketVersion</span></span><br><span class="line">agvtool new-marketing-version $&#123;localMarketVersion&#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> build version add 1</span></span><br><span class="line">localVersion=$[$localVersion+1]</span><br><span class="line">agvtool new-version -all $localVersion</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> commit (添加tag标签步骤可去除)</span></span><br><span class="line">git add -A</span><br><span class="line">git commit -m &quot;update build version to $localVersion&quot;</span><br><span class="line">git tag &quot;$&#123;localMarketVersion&#125;-$&#123;releaseType&#125;.$&#123;localVersion&#125;.$&#123;envirmentType&#125;&quot;</span><br><span class="line">echo &quot;\033[35;1mtag name is \033[0m&quot;</span><br><span class="line">echo &quot;\033[36;1m$&#123;localMarketVersion&#125;-$&#123;releaseType&#125;.$&#123;localVersion&#125;.$&#123;envirmentType&#125;\033[0m&quot;</span><br><span class="line">git push</span><br><span class="line">git push origin --tags</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">echo &quot;\033[35;1mapp version is \033[0m&quot;</span><br><span class="line">echo &quot;\033[36;1m$&#123;localMarketVersion&#125; \033[0m&quot;</span><br><span class="line"></span><br><span class="line">echo &quot;\033[35;1mnewest build version is \033[0m&quot;</span><br><span class="line">echo &quot;\033[36;1m$&#123;localVersion&#125; \033[0m&quot;</span><br><span class="line"></span><br><span class="line">sleep 2</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 是否上传分发平台(fir)</span></span><br><span class="line">is_uploadfir=&quot;false&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> firToken</span></span><br><span class="line">fir_token=&quot;xxxxxx&quot;     # xxxxxx  就是你fir平台上token</span><br><span class="line">upload_token=$fir_token</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 蒲公英上传</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 执行 curl -F <span class="string">&quot;file=@xxxxxxx.ipa&quot;</span> -F <span class="string">&quot;uKey=xxx&quot;</span> -F <span class="string">&quot;_api_key=xxx&quot;</span> https://www.pgyer.com/apiv2/app/upload      请根据开发者自己的账号，将其中的 uKey 和 _api_key 的值替换为相应的值。</span></span><br><span class="line"></span><br><span class="line">installmobileprovision</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> =======================脚本的一些固定参数定义(无特殊情况不用修改)====================== <span class="comment">#</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 切换到project目录</span></span><br><span class="line">cd $project_dir</span><br><span class="line"><span class="meta">#</span><span class="bash"> 时间</span></span><br><span class="line">DATE=`date &#x27;+%Y%m%d_%H%M%S&#x27;`</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定输出导出文件夹路径</span></span><br><span class="line">export_path=&quot;$usermain_dir/Desktop/Package/$&#123;project_name&#125;-$localMarketVersion-$localVersion-$envirmentType-$DATE-$method&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定输出归档文件路径</span></span><br><span class="line">export_archive_path=&quot;$export_path/$scheme_name.xcarchive&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定输出ipa文件夹路径</span></span><br><span class="line">export_ipa_path=&quot;$export_path&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定输出ipa名称</span></span><br><span class="line">ipa_name=&quot;$&#123;scheme_name&#125;_$&#123;DATE&#125;&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定导出ipa包需要用到的plist配置文件的路径</span></span><br><span class="line">export_options_plist_path=&quot;$project_dir/ExportOptions.plist&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">echo &quot;--------------------脚本固定参数检查--------------------&quot;</span><br><span class="line">echo &quot;\033[33;1mproject_dir=$&#123;project_dir&#125;&quot;</span><br><span class="line">echo &quot;usermain_dir=$&#123;usermain_dir&#125;&quot;</span><br><span class="line">echo &quot;DATE=$&#123;DATE&#125;&quot;</span><br><span class="line">echo &quot;export_path=$&#123;export_path&#125;&quot;</span><br><span class="line">echo &quot;export_archive_path=$&#123;export_archive_path&#125;&quot;</span><br><span class="line">echo &quot;export_ipa_path=$&#123;export_ipa_path&#125;&quot;</span><br><span class="line">echo &quot;export_options_plist_path=$&#123;export_options_plist_path&#125;&quot;</span><br><span class="line">echo &quot;ipa_name=$&#123;ipa_name&#125; \033[0m&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> =======================自动打包部分(无特殊情况不用修改)====================== <span class="comment">#</span></span></span><br><span class="line"></span><br><span class="line">echo &quot;------------------------------------------------------&quot;</span><br><span class="line">echo &quot;\033[32m开始构建项目  \033[0m&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入项目工程目录</span></span><br><span class="line">cd $&#123;project_dir&#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定输出文件目录不存在则创建</span></span><br><span class="line">if [ -d &quot;$export_path&quot; ] ; then</span><br><span class="line">    echo $export_path</span><br><span class="line">else</span><br><span class="line">    mkdir -pv $export_path</span><br><span class="line">fi</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 判断编译的项目类型是workspace还是project</span></span><br><span class="line">if $is_workspace ; then</span><br><span class="line"><span class="meta">#</span><span class="bash"> 编译前清理工程</span></span><br><span class="line">xcodebuild clean -workspace $&#123;workspace_name&#125;.xcworkspace \</span><br><span class="line">                 -scheme $&#123;scheme_name&#125; \</span><br><span class="line">                 -configuration $&#123;build_configuration&#125;</span><br><span class="line"></span><br><span class="line">xcodebuild archive -workspace $&#123;workspace_name&#125;.xcworkspace \</span><br><span class="line">                   -scheme $&#123;scheme_name&#125; \</span><br><span class="line">                   -configuration $&#123;build_configuration&#125; \</span><br><span class="line">                   -archivePath $&#123;export_archive_path&#125;</span><br><span class="line">else</span><br><span class="line"><span class="meta">#</span><span class="bash"> 编译前清理工程</span></span><br><span class="line">xcodebuild clean -project $&#123;project_name&#125;.xcodeproj \</span><br><span class="line">                 -scheme $&#123;scheme_name&#125; \</span><br><span class="line">                 -configuration $&#123;build_configuration&#125;</span><br><span class="line"></span><br><span class="line">xcodebuild archive -project $&#123;project_name&#125;.xcodeproj \</span><br><span class="line">                   -scheme $&#123;scheme_name&#125; \</span><br><span class="line">                   -configuration $&#123;build_configuration&#125; \</span><br><span class="line">                   -archivePath $&#123;export_archive_path&#125;</span><br><span class="line">fi</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">  检查是否构建成功</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  xcarchive 实际是一个文件夹不是一个文件所以使用 -d 判断</span></span><br><span class="line">if [ -d &quot;$export_archive_path&quot; ] ; then</span><br><span class="line">    echo &quot;\033[32;1m项目构建成功 🚀 🚀 🚀  \033[0m&quot;</span><br><span class="line">else</span><br><span class="line">    echo &quot;\033[31;1m项目构建失败 😢 😢 😢  \033[0m&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line">echo &quot;------------------------------------------------------&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="将Archive包导出ipa文件"><a href="#将Archive包导出ipa文件" class="headerlink" title="将Archive包导出ipa文件"></a>将Archive包导出ipa文件</h3> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">echo &quot;\033[32m开始导出ipa文件 \033[0m&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 先删除export_options_plist文件</span></span><br><span class="line">if [ -f &quot;$export_options_plist_path&quot; ] ; then</span><br><span class="line">    #echo &quot;$&#123;export_options_plist_path&#125;文件存在，进行删除&quot;</span><br><span class="line">    rm -f $export_options_plist_path</span><br><span class="line">fi</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 根据参数生成export_options_plist文件</span></span><br><span class="line">/usr/libexec/PlistBuddy -c  &quot;Add :method String $&#123;method&#125;&quot;  $export_options_plist_path</span><br><span class="line">/usr/libexec/PlistBuddy -c  &quot;Add :provisioningProfiles:&quot;  $export_options_plist_path</span><br><span class="line">/usr/libexec/PlistBuddy -c  &quot;Add :provisioningProfiles:$&#123;notificationService_identifier&#125; String $&#123;notifacationprovision_uuid&#125;&quot;  $export_options_plist_path</span><br><span class="line">/usr/libexec/PlistBuddy -c  &quot;Add :provisioningProfiles:$&#123;bundle_identifier&#125; String $&#123;mobileprovision_uuid&#125;&quot;  $export_options_plist_path</span><br><span class="line">/usr/libexec/PlistBuddy -c  &quot;Add :signingStyle String manual&quot;  $export_options_plist_path</span><br><span class="line">/usr/libexec/PlistBuddy -c  &quot;Add :destination String export&quot;  $export_options_plist_path</span><br><span class="line">/usr/libexec/PlistBuddy -c  &quot;Add :compileBitcode bool false&quot;  $export_options_plist_path</span><br><span class="line">/usr/libexec/PlistBuddy -c  &quot;Add :signingCertificate String Apple Distribution&quot; $export_options_plist_path</span><br><span class="line">/usr/libexec/PlistBuddy -c  &quot;Add :stripSwiftSymbols bool true&quot;  $export_options_plist_path   #如果您的工程是开启Bitcode的话，请把false改为true</span><br><span class="line"></span><br><span class="line">echo &quot;\033[31;1mexport_options_plist文件: $&#123;export_options_plist_path&#125;       \033[0m&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">xcodebuild  -exportArchive \</span><br><span class="line">            -archivePath $&#123;export_archive_path&#125; \</span><br><span class="line">            -exportPath $&#123;export_ipa_path&#125; \</span><br><span class="line">            -exportOptionsPlist $&#123;export_options_plist_path&#125; \</span><br><span class="line">            -allowProvisioningUpdates</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 检查ipa文件是否存在</span></span><br><span class="line">if [ -f &quot;$export_ipa_path/$project_name.ipa&quot; ] ; then</span><br><span class="line">    echo &quot;\033[32;1mexportArchive ipa包成功,准备进行重命名\033[0m&quot;</span><br><span class="line">else</span><br><span class="line">    echo &quot;\033[31;1mexportArchive ipa包失败 😢 😢 😢     \033[0m&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改ipa文件名称</span></span><br><span class="line">mv $export_ipa_path/$project_name.ipa $export_ipa_path/$ipa_name.ipa</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 检查文件是否存在</span></span><br><span class="line">if [ -f &quot;$export_ipa_path/$ipa_name.ipa&quot; ] ; then</span><br><span class="line">    echo &quot;\033[32;1m导出ipa包成功 文件路径：$export_ipa_path/$ipa_name.ipa  🎉  🎉  🎉   \033[0m&quot;</span><br><span class="line">    open $export_path</span><br><span class="line">else</span><br><span class="line">    echo &quot;\033[31;1m导出 $&#123;ipa_name&#125;.ipa 包失败 😢 😢 😢     \033[0m&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除export_options_plist文件（中间文件）</span></span><br><span class="line">if [ -f &quot;$export_options_plist_path&quot; ] ; then</span><br><span class="line">    #echo &quot;$&#123;export_options_plist_path&#125;文件存在，准备删除&quot;</span><br><span class="line">    rm -f $export_options_plist_path</span><br><span class="line">fi</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 导出ipa成功删除archive文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="keyword">if</span> [ -f <span class="string">&quot;<span class="variable">$export_ipa_path</span>/<span class="variable">$ipa_name</span>.ipa&quot;</span> ]</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="keyword">then</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="keyword">if</span> [ -d <span class="string">&quot;<span class="variable">$export_archive_path</span>&quot;</span> ]</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="keyword">then</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">    <span class="built_in">echo</span> <span class="string">&quot;\033[32;1m .ipa包导出成功 清理 <span class="variable">$&#123;export_archive_path&#125;</span> 释放空间 \033[0m&quot;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">    rm -rf <span class="variable">$export_archive_path</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="keyword">fi</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="keyword">fi</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 输出打包总用时</span></span><br><span class="line">echo &quot;\033[36;1m使用AutoPackageScript打包总用时: $&#123;SECONDS&#125;s \033[0m&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="将ipa文件签名验证上传-蒲公英-itunes"><a href="#将ipa文件签名验证上传-蒲公英-itunes" class="headerlink" title="将ipa文件签名验证上传(蒲公英/itunes)"></a>将ipa文件签名验证上传(蒲公英/itunes)</h3> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">if [ &quot;$uploadType&quot; = &quot;1&quot; ] ; then</span><br><span class="line">   echo &quot;App Store发布!!!&quot;</span><br><span class="line">   xcrun altool --validate-app -f $export_ipa_path/$ipa_name.ipa -t ios --apiKey xxxxx --apiIssuer xxxxx  --verbose</span><br><span class="line">   xcrun altool --upload-app -f $export_ipa_path/$ipa_name.ipa -t ios --apiKey xxxxx  --apiIssuer xxxxx --verbose</span><br><span class="line"></span><br><span class="line"><span class="meta">   #</span><span class="bash"> xxxxx 就是你App Store管理后台的秘钥和apiKey信息</span></span><br><span class="line"></span><br><span class="line">elif [ &quot;$uploadType&quot; = &quot;2&quot; ] ; then</span><br><span class="line">   echo &quot;上传蒲公英……&quot;</span><br><span class="line">    curl -F &quot;file=@$export_ipa_path/$ipa_name.ipa&quot; -F &quot;uKey=xxxxx&quot; -F &quot;_api_key=xxxxx&quot; https://www.pgyer.com/apiv2/app/upload</span><br><span class="line">elif [ &quot;$uploadType&quot; = &quot;3&quot; ] ; then</span><br><span class="line">   fir login -T $upload_token       # fir.im token</span><br><span class="line">   fir publish $export_ipa_path/$ipa_name.ipa</span><br><span class="line">else</span><br><span class="line">    echo &quot;不发布!!!&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">echo &quot;\033[35;1mipa文件路径\033[0m&quot;</span><br><span class="line">echo &quot;\033[32;1m$export_ipa_path/$ipa_name.ipa\033[0m&quot;</span><br><span class="line">exit 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="单独上传ipa"><a href="#单独上传ipa" class="headerlink" title="单独上传ipa"></a>单独上传ipa</h3> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line"></span><br><span class="line">teamid=xxxxx</span><br><span class="line">bundleid=xxxxx</span><br><span class="line"></span><br><span class="line">function requeststatus &#123;</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="variable">$1</span>: requestUUID</span></span><br><span class="line">requestUUID=$&#123;1?:&quot;need a request UUID&quot;&#125;</span><br><span class="line">req_status=$(xcrun altool --notarization-info &quot;$requestUUID&quot; --apiKey xxxxx --apiIssuer xxxxx 2&gt;&amp;1 | awk -F &#x27;: &#x27; &#x27;/Status:/ &#123; print $2; &#125;&#x27; )</span><br><span class="line">echo &quot;$req_status&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">echo &quot;-------------------------选择需要手动上传的平台-----------------------------&quot;</span><br><span class="line">echo &quot;\033[36;1m请选择发布平台(输入序号,按回车即可) \033[0m&quot;</span><br><span class="line">echo &quot;\033[33;1m1. AppStore      \033[0m&quot;</span><br><span class="line">echo &quot;\033[33;1m2. 蒲公英pgyer    \033[0m&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 读取用户输入并存到变量里</span></span><br><span class="line">read uploadTypeParameter</span><br><span class="line">sleep 0.5</span><br><span class="line"></span><br><span class="line">uploadType=&quot;$uploadTypeParameter&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 蒲公英上传</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 执行 curl -F <span class="string">&quot;file=@xxxxxxx.ipa&quot;</span> -F <span class="string">&quot;uKey=xxx&quot;</span> -F <span class="string">&quot;_api_key=xxx&quot;</span> https://www.pgyer.com/apiv2/app/upload      请根据开发者自己的账号，将其中的 uKey 和 _api_key 的值替换为相应的值。</span></span><br><span class="line"></span><br><span class="line">echo &quot;-------------------------输入ipa文件的路径-----------------------------&quot;</span><br><span class="line">echo &quot;\033[36;1m请输入ipa文件的路径(按回车即可) \033[0m&quot;</span><br><span class="line"></span><br><span class="line">read ipaFilePathParameter</span><br><span class="line">sleep 0.5</span><br><span class="line"></span><br><span class="line">ipaFilePath=&quot;$ipaFilePathParameter&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 检查文件是否存在</span></span><br><span class="line">if [ -f &quot;$ipaFilePath&quot; ] ; then</span><br><span class="line">echo &quot;\033[32;1m文件路径 $&#123;ipaFilePath&#125; 校验通过 🎉  🎉  🎉   \033[0m&quot;</span><br><span class="line">else</span><br><span class="line">echo &quot;\033[31;1mipa文件路径 $&#123;ipaFilePath&#125; 错误 😢 😢 😢     \033[0m&quot;</span><br><span class="line">exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if [ &quot;$uploadType&quot; = &quot;1&quot; ] ; then</span><br><span class="line">echo &quot;App Store发布!!!&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> xxxxx 就是你App Store管理后台的秘钥和apiKey信息</span></span><br><span class="line">   xcrun altool --validate-app -f $ipaFilePath -t ios --apiKey xxxxx --apiIssuer xxxxx  --verbose</span><br><span class="line">   xcrun altool --upload-app -f $ipaFilePath -t ios --apiKey xxxxx  --apiIssuer xxxxx --verbose</span><br><span class="line">   </span><br><span class="line"><span class="meta">#</span><span class="bash"> 最新校验ipa文件的方法</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">echo</span> <span class="string">&quot;xcrun altool --notarize-app --primary-bundle-id <span class="variable">$bundleid</span> --apiKey xxxxx --apiIssuer xxxxx --asc-provider <span class="variable">$teamid</span> -f <span class="variable">$ipaFilePath</span> --verbose&quot;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">requestUUID=$(xcrun altool --notarize-app --primary-bundle-id <span class="string">&quot;<span class="variable">$bundleid</span>&quot;</span> --apiKey xxxxx --apiIssuer xxxxx --asc-provider <span class="string">&quot;<span class="variable">$teamid</span>&quot;</span> -f <span class="string">&quot;<span class="variable">$ipaFilePath</span>&quot;</span> --verbose 2&gt;&amp;1 | awk <span class="string">&#x27;/RequestUUID/ &#123; print $NF; &#125;&#x27;</span>)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取上传的requestUUID</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">echo</span> <span class="string">&quot;Notarization RequestUUID: <span class="variable">$requestUUID</span>&quot;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="keyword">if</span> [[ <span class="variable">$requestUUID</span> == <span class="string">&quot;&quot;</span> ]]; <span class="keyword">then</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">echo</span> <span class="string">&quot;could not upload for notarization&quot;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">exit</span> 1</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="keyword">fi</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 根据requestUUID获取ipa处理的状态</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># wait for status to be not &quot;in progress&quot; any more</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">request_status=<span class="string">&quot;in progress&quot;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="keyword">while</span> [[ <span class="string">&quot;<span class="variable">$request_status</span>&quot;</span> == <span class="string">&quot;in progress&quot;</span> ]]; <span class="keyword">do</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">echo</span> -n <span class="string">&quot;waiting... &quot;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">sleep 10</span></span><br><span class="line"><span class="meta">#</span><span class="bash">request_status=$(requeststatus <span class="string">&quot;<span class="variable">$requestUUID</span>&quot;</span>)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$request_status</span>&quot;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="keyword">done</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">elif [ &quot;$uploadType&quot; = &quot;2&quot; ] ; then</span><br><span class="line">echo &quot;上传蒲公英……&quot;</span><br><span class="line">curl -F &quot;file=@$ipaFilePath&quot; -F &quot;uKey=xxx&quot; -F &quot;_api_key=xxx&quot; https://www.pgyer.com/apiv2/app/upload</span><br><span class="line">else</span><br><span class="line">echo &quot;不发布!!!&quot;</span><br><span class="line">exit 0</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">exit 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><ol>
<li>将脚本放在项目的根目录下</li>
<li>在根目录执行命令<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./xxx.sh xxx.sh是你自己定义的脚本文件名称(example: build.sh、 iosBuild.sh ……)</span><br></pre></td></tr></table></figure></li>
<li>选择需要编译的scheme</li>
<li>选择包类型(AdHot/Production)</li>
<li>选择需要上传的平台(蒲公英/itunes)</li>
</ol>
<h3 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h3><p>  在上传过程中可能会出现因为网络问题导致上传失败，再次上传ipa文件一直报错的问题</p>
<ul>
<li>原因：每次上传ipa文件都会生成对应的token 如果上传失败本地的token记录存在会影响下一次上传</li>
<li>解决方法：删除本地的token记录  参考 <a target="_blank" rel="noopener" href="https://blog.csdn.net/u013323045/article/details/113747595">https://blog.csdn.net/u013323045/article/details/113747595</a><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/Library/Caches/com.apple.amp.itmstransporter/UploadTokens</span><br><span class="line">删除所有.json文件</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/09/16/ios-build/" data-id="cktml6s8g000541y60k187ywe" data-title="iOS项目编译脚本" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2021/09/23/dictionary-exploration/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Neuer</strong>
      <div class="article-nav-title">
        
          Dictionary内部实现探究
        
      </div>
    </a>
  
  
    <a href="/2021/09/16/dictionary-nullvalue/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Älter</strong>
      <div class="article-nav-title">Dictionary剔除null值避免在存储的时候发生崩溃</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/09/27/podPrivatelib/">cocoapods创建私有库</a>
          </li>
        
          <li>
            <a href="/2021/09/23/dictionary-exploration/">Dictionary内部实现探究</a>
          </li>
        
          <li>
            <a href="/2021/09/16/ios-build/">iOS项目编译脚本</a>
          </li>
        
          <li>
            <a href="/2021/09/16/dictionary-nullvalue/">Dictionary剔除null值避免在存储的时候发生崩溃</a>
          </li>
        
          <li>
            <a href="/2021/09/15/codable-enumassociatevalue/">Codable处理带值的枚举</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 Jian Chen<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>